<%- require 'csv' -%>
<%= CSV.generate(CSV_DEFAULTS) do |csv|
  header= [
      t('stats.table.name'),
      t('stats.table.total')
  ]
  @distribution_names.each do |name|
    header << name
  end
  csv << header
  @contacts.each do |c|
    dist_array = []

    dist_array << c.name
    dist_array << c.attendance_total || 0
    
    @distribution.each do |d|
  	  	dist_array << number_to_percentage(c.attendance_total > 0 ? c.send("sum_#{d}")/c.attendance_total.to_f*100 : 0, :precision => 2, :strip_insignificant_zeros => true).to_s
    end

    csv << dist_array
  end
end.html_safe %>
