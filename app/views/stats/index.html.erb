<h3><%= t('stats.index.title') %></h3>

<%= form_for :stats, method: :get, html: { class: 'form-horizontal' } do |f| %>
  <fieldset>
    <div class="control-group">
      <%= f.label :distribution,t('activerecord.attributes.stat.distribution'), :class => 'control-label' %>
      <div class="controls">
        <%= select_tag :distribution, options_for_select({
              t('stats.index.by_instructor') => :instructor, 
              t('stats.index.by_time_slot') => :time_slot}, params[:distribution]) %>
      </div>
    </div>
    <div class="control-group">
      <%= f.label :start_on,t('activerecord.attributes.stat.start_on'), :class => 'control-label' %>
      <div class="controls">
        <%= f.date_select :start_on %>
      </div>
    </div>
    <div class="control-group">
      <%= f.label :end_on,t('activerecord.attributes.stat.end_on'), :class => 'control-label' %>
      <div class="controls">
        <%= f.date_select :end_on %>
      </div>
    </div>
    <div class="control-group">
      <%= f.label :include_cultural_activities,t('activerecord.attributes.stat.include_cultural_activities'), :class => 'control-label' %>
      <div class="controls">
        <%= f.check_box :include_cultural_activities %>
      </div>
    </div>
  </fieldset>

  <div class="form-actions">
    <%= f.submit t('stats.index.calculate_stats'), :class => 'btn btn-primary' %>
  </div>
<% end %>
  
<table class="table table-striped table-bordered table-hover table-condensed">
  <thead>
  	<tr>
  	  <th><%= t('stats.table.name')%></th>
  	  <th><%= t('stats.table.total')%></th>
  	  <% @distribution_names.each do |name| %>
  	  	<th><%= name %></th>
  	  <% end %>	
  	</tr>
  </thead>
  <tbody>
  <% @contacts.each do |contact| %>
  	<tr>
  	  <td><%= contact.name %></td>
  	  <td><%= contact.attendance_total || 0 %></td>	
  	  <% @distribution.each do |name| %>
  	  	<td><%= number_to_percentage contact.attendance_total > 0 ? contact.send("sum_#{name}")/contact.attendance_total.to_f*100 : 0, :precision => 2, :strip_insignificant_zeros => true %></td>
  	  <% end %>	
  	</tr>
  <% end %>
  </tbody>
</table>