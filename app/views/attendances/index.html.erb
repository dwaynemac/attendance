<%- breadcrum t("attendances.index.title") -%>

<% unless @time_slots_wout_day.empty? -%>
  <div class="alert alert-warning">
    <p><%= t('.timeslots_wout_schedule_warning') %></p>
    <ul class="list-group">
      <% @time_slots_wout_day.each do |time_slot| -%>
        <li class="list-group-item">
          <h4><%= time_slot.name %></h4>
          <h5><%= timeslot_description(time_slot) %></h5>
            <div class="btn-group">
              <%= link_to t('attendances.index.new'), new_attendance_path(attendance: {time_slot_id: time_slot.id}), :class => 'btn btn-default' %>
            </div>
        </li>
      <% end -%>
    </ul>
  </div>
<% end -%>

<% @view_range.each do |n| %>
  <div class="panel panel-default">
    <div class="panel-heading">
      <% date = n.days.ago.to_date %>
      <%= l(date, format: :in_context).capitalize %>
      <% if date.month != Date.today.month -%>
        (<%= l(date, format: :month) %>)
      <% end -%>
    </div>
    <div class="panel-body">
      <ul class="list-group">
        <% @time_slots.each do |time_slot| %>
          <% if time_slot.send(Date::DAYNAMES[date.wday].downcase.to_sym) %>
          <li class="list-group-item">
            <h4><%= time_slot.name %></h4>
            <h5><%= timeslot_description(time_slot) %></h5>
            <% if att = @attendances.select {|a| a.attendance_on == date && a.time_slot == time_slot}.first %>
              <%= link_to t('attendances.index.view'), att, :class => 'btn btn-default' %>
            <% else %>
              <div class="btn-group">
                <%= link_to t('attendances.index.new'), new_attendance_path(:attendance => {:attendance_on => date, :time_slot_id => time_slot.id}), :class => 'btn btn-default' %>
                <%= link_to t('attendances.index.new_empty'), attendances_path(:attendance => {:attendance_on => date, :time_slot_id => time_slot.id}), :method => :post, :class => 'btn btn-default' %>
              </div>
            <% end %>
          </li>
          <% end %>
        <% end %>
      </ul>
    </div>
  </div>
<% end %>

<div class="panel panel-default">
  <div class="panel-body">
    <%= link_to t('attendances.index.older'), attendances_path(days_back: 60), class: 'btn btn-primary' %>
  </div>
</div>
